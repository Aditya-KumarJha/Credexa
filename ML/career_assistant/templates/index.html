<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¯ Career Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 2rem auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .form-section {
            padding: 2rem;
        }
        
        .results-section {
            background: #f8f9fa;
            padding: 2rem;
            display: none;
        }
        
        .job-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease;
        }
        
        .job-card:hover {
            transform: translateY(-5px);
        }
        
        .score-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
        }
        
        .skill-tag {
            background: #e9ecef;
            color: #495057;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.8rem;
            margin: 0.1rem;
            display: inline-block;
        }
        
        .pros-cons {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 0.75rem;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header">
                <h1><i class="fas fa-target"></i> Career Assistant</h1>
                <p class="mb-0">Find your perfect job match with AI-powered recommendations</p>
            </div>
            
            <!-- Input Form -->
            <div class="form-section" id="form-section">
                <h3><i class="fas fa-user-edit"></i> Tell Us About Yourself</h3>
                <form id="career-form">
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="skills" class="form-label"><i class="fas fa-code"></i> Your Skills *</label>
                                <textarea class="form-control" id="skills" rows="3" placeholder="e.g., Python, Machine Learning, SQL, Project Management, React" required></textarea>
                                <div class="form-text">Enter your skills separated by commas</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="experience_level" class="form-label"><i class="fas fa-chart-line"></i> Experience Level *</label>
                                <select class="form-control" id="experience_level" required>
                                    <option value="entry">Entry Level (0-2 years)</option>
                                    <option value="mid" selected>Mid Level (2-5 years)</option>
                                    <option value="senior">Senior Level (5+ years)</option>
                                    <option value="executive">Executive Level (10+ years)</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="preferred_roles" class="form-label"><i class="fas fa-briefcase"></i> Preferred Job Roles (Optional)</label>
                                <textarea class="form-control" id="preferred_roles" rows="2" placeholder="e.g., Data Scientist, Software Engineer, Product Manager"></textarea>
                                <div class="form-text">Enter your preferred roles separated by commas (optional - will use skills if not provided)</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="location" class="form-label"><i class="fas fa-map-marker-alt"></i> Your Location</label>
                                <input type="text" class="form-control" id="location" placeholder="e.g., San Francisco, CA">
                            </div>
                        </div>
                        
                        <!-- Preferences -->
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="work_type" class="form-label"><i class="fas fa-home"></i> Work Type Preference</label>
                                <select class="form-control" id="work_type">
                                    <option value="any">Any</option>
                                    <option value="remote">Remote</option>
                                    <option value="hybrid">Hybrid</option>
                                    <option value="onsite">On-site</option>
                                </select>
                            </div>
                            
                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="salary_min" class="form-label"><i class="fas fa-dollar-sign"></i> Min Salary</label>
                                        <input type="number" class="form-control" id="salary_min" placeholder="50000">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label for="salary_max" class="form-label">Max Salary</label>
                                        <input type="number" class="form-control" id="salary_max" placeholder="120000">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="job_query" class="form-label"><i class="fas fa-search"></i> Job Search Keywords (Optional)</label>
                                <input type="text" class="form-control" id="job_query" placeholder="e.g., data scientist, python developer">
                                <div class="form-text">What type of job are you looking for? (optional - will use skills if not provided)</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="search_location" class="form-label"><i class="fas fa-globe"></i> Job Search Location</label>
                                <input type="text" class="form-control" id="search_location" placeholder="e.g., Remote, San Francisco, CA">
                            </div>
                            
                            <div class="mb-3">
                                <label for="job_limit" class="form-label"><i class="fas fa-list-ol"></i> Number of Jobs to Search</label>
                                <input type="number" class="form-control" id="job_limit" value="25" min="5" max="50">
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-rocket"></i> Find My Perfect Jobs
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loading-spinner">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h4 class="mt-3">Analyzing job opportunities...</h4>
                <p>This may take a few moments while we search and analyze the best matches for you.</p>
            </div>
            
            <!-- Results Section -->
            <div class="results-section" id="results-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="fas fa-trophy"></i> Your Top Job Recommendations</h3>
                    <div>
                        <button class="btn btn-outline-primary me-2" onclick="downloadReport()">
                            <i class="fas fa-download"></i> Download Report
                        </button>
                        <button class="btn btn-secondary" onclick="startNewSearch()">
                            <i class="fas fa-plus"></i> New Search
                        </button>
                    </div>
                </div>
                
                <div id="summary-stats" class="alert alert-info mb-4"></div>
                
                <div id="recommendations-container"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentResults = null;
        let currentPage = 1;
        const jobsPerPage = 5;
        
        document.getElementById('career-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading spinner
            document.getElementById('form-section').style.display = 'none';
            document.getElementById('loading-spinner').style.display = 'block';
            document.getElementById('results-section').style.display = 'none';
            
            // Collect form data
            const formData = {
                skills: document.getElementById('skills').value,
                experience_level: document.getElementById('experience_level').value,
                preferred_roles: document.getElementById('preferred_roles').value,
                location: document.getElementById('location').value,
                work_type: document.getElementById('work_type').value,
                salary_min: document.getElementById('salary_min').value,
                salary_max: document.getElementById('salary_max').value,
                job_query: document.getElementById('job_query').value,
                search_location: document.getElementById('search_location').value,
                job_limit: document.getElementById('job_limit').value
            };
            
            try {
                const response = await fetch('/search_jobs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                currentResults = data;
                currentPage = 1; // Reset to first page
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error: ' + error.message);
                document.getElementById('form-section').style.display = 'block';
            } finally {
                document.getElementById('loading-spinner').style.display = 'none';
            }
        });
        
        function displayResults(data) {
            // Show results section
            document.getElementById('results-section').style.display = 'block';
            
            // Display summary stats
            const summaryStats = document.getElementById('summary-stats');
            const avgScore = data.recommendations.length > 0 
                ? (data.recommendations.reduce((sum, rec) => sum + rec.overall_score, 0) / data.recommendations.length).toFixed(1)
                : 0;
            
            summaryStats.innerHTML = `
                <div class="alert alert-warning mb-3">
                    <h6><i class="fas fa-exclamation-triangle"></i> Data Source Notice</h6>
                    <p class="mb-1"><strong>Most job data shown is simulated/sample data</strong> because:</p>
                    <ul class="mb-1">
                        <li>LinkedIn, Indeed, Monster, etc. block automated scraping</li>
                        <li>Real job APIs require expensive business partnerships</li>
                        <li>This demo uses high-quality sample data to showcase functionality</li>
                    </ul>
                    <small>Look for the <span class="badge bg-success">Real Data</span> badges for actual job postings.</small>
                </div>
                <h5><i class="fas fa-chart-bar"></i> Search Summary</h5>
                <div class="row">
                    <div class="col-md-3"><strong>Jobs Found:</strong> ${data.total_jobs_found}</div>
                    <div class="col-md-3"><strong>Top Matches:</strong> ${data.recommendations.length}</div>
                    <div class="col-md-3"><strong>Average Score:</strong> ${avgScore}/100</div>
                    <div class="col-md-3"><strong>Experience Level:</strong> ${data.user_profile.experience_level}</div>
                </div>
            `;
            
            // Display paginated recommendations
            displayPaginatedJobs(data.recommendations);
        }
        
        function displayPaginatedJobs(recommendations) {
            const container = document.getElementById('recommendations-container');
            const totalJobs = recommendations.length;
            const totalPages = Math.ceil(totalJobs / jobsPerPage);
            
            // Calculate start and end indices for current page
            const startIndex = (currentPage - 1) * jobsPerPage;
            const endIndex = Math.min(startIndex + jobsPerPage, totalJobs);
            const currentJobs = recommendations.slice(startIndex, endIndex);
            
            // Clear container
            container.innerHTML = '';
            
            // Add pagination info
            const paginationInfo = document.createElement('div');
            paginationInfo.className = 'alert alert-light mb-3';
            paginationInfo.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-list"></i> Showing jobs ${startIndex + 1}-${endIndex} of ${totalJobs}</span>
                    <span>Page ${currentPage} of ${totalPages}</span>
                </div>
            `;
            container.appendChild(paginationInfo);
            
            // Display current page jobs
            currentJobs.forEach((rec, index) => {
                const globalRank = startIndex + index + 1;
                const jobCard = createJobCard(rec, globalRank);
                container.appendChild(jobCard);
            });
            
            // Add pagination controls
            if (totalPages > 1) {
                const paginationControls = createPaginationControls(currentPage, totalPages);
                container.appendChild(paginationControls);
            }
        }
        
        function createPaginationControls(page, totalPages) {
            const controls = document.createElement('div');
            controls.className = 'pagination-controls d-flex justify-content-center align-items-center mt-4';
            
            controls.innerHTML = `
                <nav aria-label="Job recommendations pagination">
                    <ul class="pagination">
                        <li class="page-item ${page === 1 ? 'disabled' : ''}">
                            <button class="page-link" onclick="goToPage(${page - 1})" ${page === 1 ? 'disabled' : ''}>
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                        </li>
                        
                        ${generatePageNumbers(page, totalPages)}
                        
                        <li class="page-item ${page === totalPages ? 'disabled' : ''}">
                            <button class="page-link" onclick="goToPage(${page + 1})" ${page === totalPages ? 'disabled' : ''}>
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </li>
                    </ul>
                </nav>
            `;
            
            return controls;
        }
        
        function generatePageNumbers(currentPage, totalPages) {
            let pages = '';
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            // Adjust start if we're near the end
            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            // Add first page and ellipsis if needed
            if (startPage > 1) {
                pages += `<li class="page-item"><button class="page-link" onclick="goToPage(1)">1</button></li>`;
                if (startPage > 2) {
                    pages += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }
            
            // Add page numbers
            for (let i = startPage; i <= endPage; i++) {
                pages += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <button class="page-link" onclick="goToPage(${i})">${i}</button>
                    </li>
                `;
            }
            
            // Add last page and ellipsis if needed
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pages += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
                pages += `<li class="page-item"><button class="page-link" onclick="goToPage(${totalPages})">${totalPages}</button></li>`;
            }
            
            return pages;
        }
        
        function goToPage(page) {
            if (!currentResults || page < 1 || page > Math.ceil(currentResults.recommendations.length / jobsPerPage)) {
                return;
            }
            
            currentPage = page;
            displayPaginatedJobs(currentResults.recommendations);
            
            // Scroll to top of results
            document.getElementById('results-section').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }
        
        function createJobCard(rec, rank) {
            const card = document.createElement('div');
            card.className = 'job-card';
            
            const scoreColor = rec.overall_score >= 80 ? '#28a745' : 
                              rec.overall_score >= 60 ? '#ffc107' : '#dc3545';
            
            card.innerHTML = `
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div>
                        <h4 class="mb-1">${rank}. ${rec.title}</h4>
                        <h6 class="text-muted mb-1"><i class="fas fa-building"></i> ${rec.company}</h6>
                        <p class="mb-1"><i class="fas fa-map-marker-alt"></i> ${rec.location}</p>
                        ${rec.salary_range ? `<p class="mb-0"><i class="fas fa-dollar-sign"></i> ${rec.salary_range}</p>` : ''}
                    </div>
                    <div class="text-end">
                        <div class="score-badge" style="background: ${scoreColor}">
                            ${rec.overall_score}/100
                        </div>
                        ${rec.work_type ? `<div class="mt-2"><span class="badge bg-secondary">${rec.work_type}</span></div>` : ''}
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6><i class="fas fa-chart-pie"></i> Score Breakdown:</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <small>Skill Match:</small>
                            <div class="progress mb-2">
                                <div class="progress-bar" style="width: ${rec.score_breakdown.skill_match}%"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <small>Role Relevance:</small>
                            <div class="progress mb-2">
                                <div class="progress-bar" style="width: ${rec.score_breakdown.role_relevance}%"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <small>Experience Fit:</small>
                            <div class="progress mb-2">
                                <div class="progress-bar" style="width: ${rec.score_breakdown.experience_fit}%"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <small>Growth Potential:</small>
                            <div class="progress mb-2">
                                <div class="progress-bar" style="width: ${rec.score_breakdown.growth_potential}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6><i class="fas fa-lightbulb"></i> Why this job fits:</h6>
                    <p>${rec.explanation}</p>
                </div>
                
                <div class="pros-cons">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-success"><i class="fas fa-check-circle"></i> Strengths:</h6>
                            <ul class="list-unstyled">
                                ${rec.pros.map(pro => `<li><i class="fas fa-plus text-success"></i> ${pro}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="col-md-6">
                            ${rec.cons.length > 0 ? `
                                <h6 class="text-warning"><i class="fas fa-exclamation-triangle"></i> Considerations:</h6>
                                <ul class="list-unstyled">
                                    ${rec.cons.map(con => `<li><i class="fas fa-minus text-warning"></i> ${con}</li>`).join('')}
                                </ul>
                            ` : ''}
                        </div>
                    </div>
                </div>
                
                ${rec.skill_gaps.length > 0 ? `
                    <div class="mt-3">
                        <h6><i class="fas fa-graduation-cap"></i> Skills to develop:</h6>
                        <div class="mb-2">
                            ${rec.skill_gaps.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                        </div>
                        ${rec.skill_gaps.length > 0 && rec.learning_suggestions[rec.skill_gaps[0]] ? `
                            <small class="text-muted">
                                <strong>How to learn ${rec.skill_gaps[0]}:</strong> 
                                ${rec.learning_suggestions[rec.skill_gaps[0]].slice(0, 2).join(', ')}
                            </small>
                        ` : ''}
                    </div>
                ` : ''}
                
                <div class="mt-3 d-flex justify-content-between align-items-center">
                    <div>
                        ${getSourceDisplay(rec.source)}
                    </div>
                    <div>
                        ${rec.url && rec.url !== '' && !isSimulatedUrl(rec.url) ? `
                            <button class="btn btn-primary btn-sm" onclick="applyToJob('${rec.url}', '${rec.title}', '${rec.company}')">
                                <i class="fas fa-external-link-alt"></i> Apply Now
                            </button>
                        ` : rec.url && isSimulatedUrl(rec.url) ? `
                            <button class="btn btn-outline-warning btn-sm" disabled title="This is sample data - no real job posting">
                                <i class="fas fa-flask"></i> Sample Job
                            </button>
                        ` : `
                            <button class="btn btn-outline-secondary btn-sm" disabled>
                                <i class="fas fa-info-circle"></i> Contact Company
                            </button>
                        `}
                    </div>
                </div>
            `;
            
            return card;
        }
        
        function getSourceDisplay(source) {
            const sampleSources = ['linkedin-api', 'naukri', 'monster', 'careerbuilder', 'simplyhired', 'angellist', 'dice', 'adzuna-sample'];
            const realSources = ['adzuna-real', 'linkedin', 'indeed-real', 'apify-linkedin', 'apify-indeed'];
            
            if (realSources.includes(source)) {
                return `<small class="text-success"><i class="fas fa-globe"></i> Source: ${source} <span class="badge bg-success">Real Data</span></small>`;
            } else if (sampleSources.includes(source)) {
                return `<small class="text-warning"><i class="fas fa-flask"></i> Source: ${source} <span class="badge bg-warning text-dark">Sample Data</span></small>`;
            } else {
                return `<small class="text-muted"><i class="fas fa-globe"></i> Source: ${source || 'career-assistant'}</small>`;
            }
        }
        
        function isSimulatedUrl(url) {
            // Check if URL contains patterns indicating sample data
            const samplePatterns = [
                'monster.com/jobs/12',
                'careerbuilder.com/jobs/12',
                'simplyhired.com/jobs/12',
                'wellfound.com/jobs/12',
                'dice.com/jobs/12',
                'linkedin.com/jobs/12',
                'naukri.com/jobs/12'
            ];
            
            return samplePatterns.some(pattern => url.includes(pattern));
        }
        
        function applyToJob(url, title, company) {
            // Track application click (you could send analytics here)
            console.log(`User applied to: ${title} at ${company}`);
            
            // Show confirmation
            if (confirm(`You're about to apply for "${title}" at ${company}. This will open the job posting in a new tab. Continue?`)) {
                // Open job posting in new tab
                window.open(url, '_blank', 'noopener,noreferrer');
                
                // Show success message
                setTimeout(() => {
                    const toast = document.createElement('div');
                    toast.className = 'alert alert-success position-fixed';
                    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                    toast.innerHTML = `
                        <i class="fas fa-check-circle"></i> 
                        Good luck with your application to <strong>${company}</strong>!
                        <button type="button" class="btn-close float-end" onclick="this.parentElement.remove()"></button>
                    `;
                    document.body.appendChild(toast);
                    
                    // Auto remove after 5 seconds
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            toast.remove();
                        }
                    }, 5000);
                }, 1000);
            }
        }
        
        async function downloadReport() {
            if (!currentResults) return;
            
            try {
                const response = await fetch('/download_report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(currentResults)
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = 'career_recommendations_report.txt';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                } else {
                    throw new Error('Failed to download report');
                }
            } catch (error) {
                alert('Error downloading report: ' + error.message);
            }
        }
        
        function startNewSearch() {
            document.getElementById('form-section').style.display = 'block';
            document.getElementById('results-section').style.display = 'none';
            currentResults = null;
        }
    </script>
</body>
</html>